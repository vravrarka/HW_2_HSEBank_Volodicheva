# HW_2_HSEBank_Volodicheva
# Володичева Варвара
# БПИ-247

## Общая идея решения

Разработана система финансового учета для банковского приложения, реализующая модуль учета финансов с возможностью управления счетами, категориями операций и финансовыми операциями. Система предоставляет полный цикл работы с финансовыми данными: создание, анализ, импорт/экспорт.

### Реализованный функционал:
- **Управление счетами**: создание, просмотр, удаление банковских счетов
- **Управление категориями**: создание категорий доходов и расходов
- **Управление операциями**: регистрация доходов/расходов с автоматическим пересчетом баланса
- **Аналитика**: анализ разницы доходов/расходов, группировка по категориям
- **Импорт/экспорт**: поддержка CSV, JSON, YAML форматов
- **Измерение производительности**: тайминг выполнения операций
- **Проверка целостности данных**: автоматическое обнаружение и исправление несоответствий баланса
- **Стратегии пересчета баланса**: различные алгоритмы пересчета с возможностью выбора

### Дополнительный реализованный функционал:
- **Автоматический пересчет баланса**: система проверяет соответствие текущего баланса с рассчитанным на основе операций
- **Интеграция стратегий пересчета**: поддержка различных алгоритмов пересчета через DI-контейнер

## Принципы SOLID и GRASP

### SOLID принципы:

1. **Single Responsibility Principle (SRP)**
   - `BankAccountFacade`, `CategoryFacade`, `OperationFacade` - каждый отвечает за свою предметную область
   - `DataVisitor` и его реализации - отдельная ответственность для экспорта данных
   - `DataImporter` и реализации - отдельная ответственность для импорта
   - `IBalanceRecalculationStrategy` - отдельная ответственность за алгоритмы пересчета баланса

2. **Open/Closed Principle (OCP)**
   - `DataVisitor` позволяет добавлять новые форматы экспорта без изменения существующего кода
   - `DataImporter` позволяет добавлять новые форматы импорта
   - `IBalanceRecalculationStrategy` позволяет добавлять новые стратегии пересчета
   - `YamlDataImporter` поддерживает multiple форматы YAML файлов

3. **Liskov Substitution Principle (LSP)**
   - Все реализации `DataVisitor` могут взаимозаменяемо использоваться в `ExportFacade`
   - Все реализации `DataImporter` взаимозаменяемы в `ImportFacade`
   - Все реализации `IBalanceRecalculationStrategy` взаимозаменяемы в `FinancialAccountingFacade`

4. **Interface Segregation Principle (ISP)**
   - `IBalanceRecalculationStrategy` - узкоспециализированный интерфейс для пересчета баланса
   - `IVisitable` - минимальный интерфейс для посетителя
   - `DataImporter` - четко определенный интерфейс для импорта данных

5. **Dependency Inversion Principle (DIP)**
   - `FinancialAccountingFacade` зависит от абстракций фасадов и стратегий
   - Использование DI-контейнера для управления зависимостями
   - `IBalanceRecalculationStrategy` внедряется через конструктор

### GRASP принципы:

1. **High Cohesion**
   - Каждый фасад имеет четкую зону ответственности
   - Классы импорта/экспорта сфокусированы на одной задаче
   - Стратегии пересчета баланса содержат только логику расчета

2. **Low Coupling**
   - Фасады слабо связаны через интерфейсы
   - DI-контейнер уменьшает связанность между компонентами
   - `FinancialAccountingFacade` зависит от абстракций, а не конкретных реализаций

3. **Controller**
   - `ConsoleMenuManager` выступает в роли контроллера для пользовательского интерфейса
   - `FinancialAccountingFacade` координирует работу между различными компонентами системы

4. **Creator**
   - `ObjectCreator` и его наследники отвечают за создание доменных объектов
   - `FinancialAccountingFacade` создает команды для выполнения операций

## Паттерны GoF

### Порождающие паттерны:

1. **Фабричный метод (Factory Method)**
   - **Классы**: `ObjectCreator`, `BankAccountCreator`, `CategoryCreator`, `OperationCreator`
   - **Важность**: Централизованное создание объектов с валидацией, гарантирует корректность доменных объектов

2. **Одиночка (Singleton)**
   - **Классы**: `DataRepository`
   - **Важность**: Единая точка доступа к данным приложения

### Структурные паттерны:

3. **Фасад (Facade)**
   - **Классы**: `BankAccountFacade`, `CategoryFacade`, `OperationFacade`, `FinancialAccountingFacade`, `ImportFacade`, `ExportFacade`
   - **Важность**: Упрощение сложной подсистемы, предоставление единого интерфейса

4. **Прокси (Proxy)**
   - **Классы**: `BankAccountRepositoryProxy`
   - **Важность**: Кэширование данных для уменьшения обращений к "базе данных"

5. **Декоратор (Decorator)**
   - **Классы**: `TimedCommandDecorator`
   - **Важность**: Добавление функциональности измерения времени без изменения исходных команд

6. **Посетитель (Visitor)**
   - **Классы**: `DataVisitor`, `CsvDataVisitor`, `JsonDataVisitor`, `YamlDataVisitor`
   - **Важность**: Разделение алгоритмов экспорта от структуры объектов

### Поведенческие паттерны:

7. **Команда (Command)**
   - **Классы**: `Command`, `CreateAccountCommand`, `CreateOperationCommand`, `ExportDataCommand`, `ImportDataCommand`
   - **Важность**: Инкапсуляция запросов как объектов, поддержка отмены операций

8. **Шаблонный метод (Template Method)**
   - **Классы**: `DataImporter` и его реализации
   - **Важность**: Определение скелета алгоритма импорта с возможностью переопределения шагов

9. **Стратегия (Strategy)**
   - **Классы**: `IBalanceRecalculationStrategy`, `SimpleRecalculationStrategy`, `ConservativeRecalculationStrategy`
   - **Важность**: Возможность динамического выбора алгоритма пересчета баланса

### Предварительные требования:
- .NET 9.0 SDK или выше
- Поддерживаемая ОС (Windows, Linux, macOS)

### Шаги для запуска:

1. **Клонирование или распаковка проекта**
   ```bash
   # Если проект в репозитории
   git clone <repository-url>
   cd Bank
   ```

2. **Восстановление зависимостей**
   ```bash
   dotnet restore
   ```

3. **Сборка проекта**
   ```bash
   dotnet build
   ```

4. **Запуск приложения**
   ```bash
   dotnet run
   ```

### Использование:

После запуска откроется консольное меню с следующими опциями:

1. **Управление счетами** - создание и удаление банковских счетов
2. **Управление категориями** - создание категорий доходов и расходов  
3. **Управление операциями** - регистрация финансовых операций
4. **Аналитика и отчеты** - просмотр статистики и аналитики, включая новые функции проверки целостности
5. **Импорт/Экспорт данных** - работа с внешними файлами
6. **Выход** - завершение работы приложения

### "Управление счетами":
 - **Создать счет** - ручное создание счета из консоли
 - **Удалить счет** - удаляет счет по ID счета
### "Управление категориями":
 - **Создать категорию доходов** - ручное создание категории доходов
 - **Создать категорию расходов** - ручное создание категории расходов
### "Управление операциями":
 - **Создать операцию дохода** - ручное создание операции дохода (Баланс автоматически перешитывается)
 - **Создать операцию расхода** - ручное создание операции расхода (Баланс автоматически перешитывается)
 - **Отменить операцию"** - удаление операции по ID операции

### "Аналитика и отчеты":
- **Разница доходов и расходов за период** - расчет разницы между доходами и расходами за выбранный временной промежуток
- **Группировка доходов по категориям** - анализ доходов с группировкой по категориям для выявления основных источников поступлений
- **Группировка расходов по категориям** - анализ расходов с группировкой по категориям для определения основных статей затрат
- **Общая сводка по категориям** - комплексный отчет по всем категориям с отображением доходов и расходов
- **Общая статистика по счету** - сводная информация по выбранному счету с отображением общего дохода, расходов и баланса
- **Проверить целостность данных счета** - проверка соответствия баланса операциям
- **Проверить все счета** - массовая проверка всех счетов в системе
- **Принудительный пересчет баланса** - ручной пересчет баланса счета
- 
### "Импорт/Экспорт данных":
- **Экспорт в CSV** - выгрузка всех данных в формат CSV с разделителями-запятыми
- **Экспорт в JSON** - экспорт данных в структурированный JSON формат
- **Экспорт в YAML** - сохранение данных в YAML формате с человеко-читаемой структурой
- **Импорт данных** - загрузка данных из внешних файлов различных форматов
- **Назад** - возврат в главное меню приложения

### "Импорт данных":
- **Импорт счетов** - загрузка банковских счетов из файла (CSV, JSON, YAML)
- **Импорт категорий** - импорт категорий доходов и расходов из внешнего файла
- **Импорт операций** - загрузка финансовых операций из файла с автоматическим пересчетом балансов
  
### Форматы файлов для импорта:
Тестовые файлы, которые можно использовать в приложении лежат тут: `КПО_2/Data/...`

### Пример работы:
1. Создайте счет через меню "Управление счетами" / Или импортируйте данные из файла
2. Добавьте категории доходов/расходов
3. Зарегистрируйте финансовые операции
4. Проверьте целостность данных через меню "Аналитика"
5. При обнаружении несоответствий система предложит автоматическое исправление
6. Экспортируйте данные в нужном формате

Приложение использует интерактивный консольный интерфейс с подсказками для каждого действия.
